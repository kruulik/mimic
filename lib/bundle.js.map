{"version":3,"sources":["webpack:///webpack/bootstrap 41276febd76a4d3e714c","webpack:///./lib/detector.js","webpack:///./lib/emoji.js","webpack:///./lib/mimic.js","webpack:///./lib/game.js","webpack:///./lib/falling_emoji.js","webpack:///./lib/announce.js"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;;;AC3DC;;;AAGD;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCAAwC;;AAExC;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;AACA,KAAK;;;;AAIL;;;AAGA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,KAAK;;AAEL;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,SAAS;;AAET,OAAO;AACP;AACA;AACA;AACA,4DAA4D;AAC5D;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,OAAO;AACP;AACA;;AAEA,KAAK;;AAEL;;;AAGA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA,KAAK;;AAEL;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;;;;;;;;ACtPA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;;;;;;;;;;;AClDA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA,CAAC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;;;;;;;;;;ACzBA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA,KAAK;;AAEL;AACA;AACA;AACA;AACA;AACA,SAAS;AACT,OAAO;AACP;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA,SAAS;AACT;AACA;AACA;;AAEA;AACA;AACA;;AAEA,KAAK;;AAEL;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;AAGA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL,+CAA+C,WAAW;AAC1D;AACA,kCAAkC,WAAW;AAC7C,KAAK;AACL;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,mBAAmB,yBAAyB;AAC5C;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAAK;;AAEL;AACA;;AAEA;;AAEA;;;;;;;;;AC7QC;;AAED;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;;AAEA;;AAEA;;;;;;;;;ACxDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,gCAAgC,OAAO;AACvC,kCAAkC,OAAO;AACzC;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA,2BAA2B,MAAM;AACjC;;AAEA;AACA;AACA;AACA;AACA;AACA,yBAAyB,QAAQ;AACjC;;;AAGA;AACA;AACA;AACA;;AAEA;;AAEA;;AAEA;;AAEA;;AAEA","file":"./lib/bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 41276febd76a4d3e714c","import {\n  EmojiImages\n} from './emoji';\n\n\nclass Detector {\n\n  constructor(options) {\n    this.game = options.game;\n    this.gameRoot = options.gameRoot;\n    this.dt_canvas = null;\n    this.dt_ctx = null;\n    this.detector = new affdex.CameraDetector(this.gameRoot);\n    this.detector.detectAllEmojis();\n    this.init = this.init.bind(this);\n    this.analyze = this.analyze.bind(this);\n    this.getMaskSize = this.getMaskSize.bind(this);\n    this.getFaceCenter = this.getFaceCenter.bind(this);\n    this.drawFeaturePoints = this.drawFeaturePoints.bind(this);\n    this.drawMask = this.drawMask.bind(this);\n    this.toggleDetector = this.toggleDetector.bind(this);\n    this.dominantEmoji = null;\n    this.toMatch = null;\n    this.frames = 0;\n    this.animationFrames = 0;\n    this.face_visible = false;\n    this.face = null;\n    this.image = null;\n    this.emoji_images = Object.assign({}, EmojiImages.ui, EmojiImages.falling);\n\n    this.recenterTimeout = null;\n    this.faceDetected = this.faceDetected.bind(this);\n    this.noFaceDetected = this.noFaceDetected.bind(this);\n\n  }\n\n  init() {\n    this.detector.addEventListener(\"onInitializeSuccess\", () => {\n      this.dt_canvas = document.getElementById(\"face_video_canvas\");\n      this.dt_ctx = this.dt_canvas.getContext('2d');\n      const video = document.getElementById(\"face_video\");\n      this.dt_canvas.style.display = 'block';\n      video.style.display = 'none';\n      if (this.detector.isRunning) {\n        let loading = document.querySelector(\".loading\");\n        loading.classList.toggle('hidden');\n      }\n    });\n\n    this.detector.addEventListener(\"onInitializeFailure\", () => {\n      console.log('initialize failed');\n    });\n\n\n\n  }\n\n\n  analyze() {\n    const loading = document.querySelector(\".loading\");\n    this.detector.addEventListener(\"onImageResultsSuccess\", (faces, image, timestamps) => {\n\n      this.image = image;\n      this.timestamps = timestamps;\n      this.face = faces[0];\n      // this.recenterFace();\n      this.detectFace();\n      // this.noFaceDetected();\n\n    });\n\n  }\n\n  detectFace() {\n\n    if (this.frames > 200 && this.face_visible) {\n      this.noFaceDetected();\n    }\n    if (this.face) {\n      this.frames = 0;\n      this.faceDetected();\n    } else {\n      this.frames++;\n      console.log('no face');\n    }\n  }\n\n  faceDetected() {\n    this.face_visible = true;\n\n    if (!this.game.emojiAreFalling && this.game.playing) {\n      this.game.emojiAreFalling = true;\n      this.game.emojiStart();\n    }\n\n    this.dominantEmoji = this.face.emojis.dominantEmoji.codePointAt(0);\n  }\n\n  noFaceDetected() {\n    this.game.fallingEmoji = {};\n    this.game.emojiAreFalling = false;\n    this.game.playing = false;\n    this.face_visible = false;\n\n    this.recenterFace()\n      .then(() => {\n        this.face_visible = true;\n        this.game.playing = true;\n        clearInterval(this.game.emojiInterval);\n\n        // this.game.emojiStart();\n        this.frames = 0;\n        this.drawFeaturePoints(2000).then(() => {\n          this.detectFace();\n        });\n\n      })\n      .catch(\n        (reason) => {\n          console.log(reason);\n          alert('Cannot detect face! Please reload the page; something broke :( ');\n        }\n      );\n  }\n\n  recenterFace() {\n\n    if (!this.detector.isRunning){\n      this.analyze();\n\n    }\n\n    let timeout = Array.from(new Array(200), (val, index) => index * 100 + 100);\n\n    return new Promise((resolve, reject) => {\n\n      let startTime, time;\n      let faceFound = false;\n      // this.game.recenterMask();\n      let findFace = () => {\n        time = new Date().getTime() - startTime;\n        time = time / 10000;\n        this.game.recenterStartTime = new Date().getTime();\n        if (this.face){\n          faceFound = true;\n          return resolve('face found');\n        }\n        if (time < 1) requestAnimationFrame(findFace);\n      };\n      startTime = new Date().getTime();\n\n      if (!faceFound){\n        findFace();\n      } else {\n        return reject('no face found');\n      }\n\n    });\n\n  }\n\n\n  drawFeaturePoints(duration) {\n\n    return new Promise(resolve => {\n\n      let startTime, time;\n      let animation = () => {\n        time = new Date().getTime() - startTime;\n        time = time / duration;\n        let img = this.image;\n        let featurePoints = this.face.featurePoints;\n        let hRatio = this.dt_ctx.canvas.width / img.width;\n        let wRatio = this.dt_ctx.canvas.height / img.height;\n        let ratio = Math.min(hRatio, wRatio);\n\n        let maskPos = this.getFaceCenter(featurePoints);\n        let maskSize = this.getMaskSize(featurePoints);\n        if (time<1) requestAnimationFrame(animation);\n\n        this.dt_ctx.strokeStyle = \"#FFFFFF\";\n        this.dt_ctx.beginPath();\n        this.dt_ctx.arc(maskPos[0], maskPos[1], (maskSize), 0, 2 * Math.PI);\n        this.dt_ctx.stroke();\n      };\n      startTime = new Date().getTime();\n      animation();\n\n      return resolve('back to normal');\n\n    });\n\n  }\n\n  drawMask() {\n    let img = this.image;\n    let featurePoints = this.face.featurePoints;\n    let hRatio = this.dt_ctx.canvas.width / img.width;\n    let wRatio = this.dt_ctx.canvas.height / img.height;\n    let ratio = Math.min(hRatio, wRatio);\n\n    let maskSize = this.getMaskSize(featurePoints) * 3;\n    let faceCenter = this.getFaceCenter(featurePoints);\n\n    this.dt_ctx.drawImage(this.mask, faceCenter[0] - (maskSize / 2), faceCenter[1] / 2, maskSize, maskSize);\n  }\n\n  getMaskSize(fP) {\n    let rx, ry, lx, ly, rxAVG, ryAVG, lxAVG, lyAVG;\n\n    rx = [fP[17].x, fP[16].x];\n    lx = [fP[18].x, fP[19].x];\n    ry = [fP[17].y, fP[16].y];\n    ly = [fP[18].y, fP[19].y];\n\n    rxAVG = rx.reduce((acc, num) => acc + num, 0) / 2;\n    ryAVG = ry.reduce((acc, num) => acc + num, 0) / 2;\n    lxAVG = lx.reduce((acc, num) => acc + num, 0) / 2;\n    lyAVG = ly.reduce((acc, num) => acc + num, 0) / 2;\n    return Math.hypot(\n      (rxAVG - lxAVG),\n      (ryAVG - lyAVG)\n    );\n  }\n\n  getFaceCenter(fP) {\n    let cx = [fP[11].x, fP[17].x, fP[18].x];\n    let cy = [fP[11].y, fP[17].y, fP[18].y];\n\n    let cxAVG = cx.reduce((acc, num) => acc + num) / cx.length;\n    let cyAVG = cy.reduce((acc, num) => acc + num) / cy.length;\n    return [cxAVG, cyAVG];\n  }\n\n  toggleDetector() {\n    if (!this.detector.isRunning) {\n      this.detector.start();\n    } else {\n      this.detector.removeEventListener();\n      this.detector.stop();\n      clearInterval(this.game.emojiInterval);\n      this.game.playing = false;\n    }\n  }\n\n}\n\nexport default Detector;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lib/detector.js\n// module id = 0\n// module chunks = 0","\n// export const EmojiImages = {\n//\n//   falling: {\n//     128518: \"assets/emoji/laughing.png\",\n//     128515: \"assets/emoji/smiley.png\",\n//     9786: \"assets/emoji/relaxed.png\",\n//     128521: \"assets/emoji/wink.png\",\n//     128535: \"assets/emoji/kissing.png\",\n//     128539: \"assets/emoji/stuckOutTongue.png\",\n//     128540: \"assets/emoji/stuckOutTongueWinkingEye.png\",\n//     128561: \"assets/emoji/scream.png\",\n//     128563: \"assets/emoji/flushed.png\",\n//     128527: \"assets/emoji/smirk.png\",\n//     128542: \"assets/emoji/disappointed.png\",\n//     128545: \"assets/emoji/rage.png\",\n//     128528: \"assets/emoji/neutral.png\",\n//   },\n//   ui: {\n//     128128: \"assets/emoji/skull.png\",\n//     128169: \"assets/emoji/poo.png\",\n//     128077: \"assets/emoji/thumbUp.png\",\n//     128078: \"assets/emoji/thumbDown.png\",\n//     128081: \"assets/emoji/crown.png\",\n//   }\n// };\nexport const EmojiImages = {\n\n  falling: {\n    128518: \"assets/svg/happy-4.svg\",\n    128515: \"assets/svg/happy-5.svg\",\n    9786: \"assets/svg/happy-2.svg\",\n    128521: \"assets/svg/wink.svg\",\n    128535: \"assets/svg/kiss.svg\",\n    128539: \"assets/svg/tongue.svg\",\n    128540: \"assets/svg/wink.svg\",\n    128561: \"assets/svg/surprised-2.svg\",\n    128563: \"assets/svg/surprised-4.svg\",\n    128527: \"assets/svg/cool.svg\",\n    128542: \"assets/svg/sad.svg\",\n    128545: \"assets/svg/angry.svg\",\n    128528: \"assets/svg/confused.svg\",\n  },\n  ui: {\n    128128: \"assets/svg/skull.svg\",\n    128169: \"assets/svg/poo.svg\",\n    128077: \"assets/svg/thumbUp.svg\",\n    128078: \"assets/svg/thumbDown.svg\",\n    128081: \"assets/svg/crown.svg\",\n  }\n};\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lib/emoji.js\n// module id = 1\n// module chunks = 0","import Detector from './detector';\nimport Game from './game';\n\ndocument.addEventListener(\"DOMContentLoaded\", function(){\n  const gameRoot = document.getElementById(\"game-root\");\n  const game = new Game(gameRoot);\n  const openModalButton = document.querySelector(\".open-modal\");\n  openModalButton.addEventListener(\"click\", openModal);\n  game.init();\n\n});\n\nfunction openModal() {\n  const demoModal = document.getElementById(\"demo-modal\");\n  const closeModalAction = document.querySelector(\".modal-container\");\n  const demoVideo = document.querySelector(\".demo-video\");\n  closeModalAction.addEventListener(\"click\", closeModal);\n  demoModal.classList.toggle('hidden');\n  demoVideo.play();\n  demoVideo.playbackRate = 2;\n}\n\nfunction closeModal() {\n  const demoModal = document.getElementById(\"demo-modal\");\n  demoModal.classList.toggle('hidden');\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lib/mimic.js\n// module id = 2\n// module chunks = 0","import Detector from './detector';\nimport FallingEmoji from './falling_emoji';\nimport Announce from './announce';\n\nclass Game {\n  constructor(gameRoot) {\n    this.init = this.init.bind(this);\n    this.detector = new Detector({\n      gameRoot: gameRoot,\n      game: this\n    });\n    this.ui_canvas = document.getElementById(\"ui_canvas\");\n    this.ui_ctx = ui_canvas.getContext('2d');\n    this.displayScore = document.querySelectorAll(\".score\");\n    this.startScreen = document.querySelector(\".info-screen.start\");\n    this.endScreen = document.querySelector(\".info-screen.end\");\n    this.strikes = 0;\n    this.emojiInterval = null;\n\n    this.velocity = 2;\n    this.renderDelay = 3000;\n    this.multiplier = 1;\n    this.score = 0;\n\n    this.faceVisible = this.detector.face_visible;\n    this.recenterStartTime = null;\n    this.playing = false;\n    this.emojiAreFalling = false;\n\n    this.fallingEmoji = {};\n    this.lastEmoji = null;\n    this.alerts = [];\n\n    this.renderEmoji = this.renderEmoji.bind(this);\n    this.getStrike = this.getStrike.bind(this);\n    this.emojiStart = this.emojiStart.bind(this);\n    this.mask = null;\n    this.timer = 30;\n\n    this.dominantEmoji = null;\n\n  }\n\n  init() {\n    const toggleButton = document.querySelector(\"button\");\n    this.detector.init();\n\n    toggleButton.addEventListener(\"click\", () => {\n      this.detector.toggleDetector();\n      this.detector.noFaceDetected();\n      this.startScreen.classList.toggle('hidden');\n      // this.playing = true;\n      this.checkMatch();\n    });\n  }\n\n  emojiStart() {\n    this.displayScore.forEach((score) => {\n      score.innerHTML = 'Score: 0';\n    });\n    this.start().then(() => {\n      this.gameOver();\n    });\n\n    if (this.playing) {\n      setTimeout(() => {\n        this.renderEmoji();\n        this.emojiInterval = setInterval(() => {\n          this.renderEmoji();\n        }, this.renderDelay);\n      }, 2000);\n    }\n  }\n\n  gameOver() {\n    clearInterval(this.emojiInterval);\n\n    setTimeout(() => {\n      this.detector.toggleDetector();\n      this.endScreen.classList.toggle('hidden');\n    }, 500);\n  }\n\n  start() {\n\n    return new Promise(resolve => {\n      let startTime, runTime, timerWidth;\n      this.lastTime = 0;\n      // let timeTime, timeTimeTIMEtime, timeytime;\n      let animate = (time) => {\n        const timeDelta = time - this.lastTime;\n        runTime = new Date().getTime() - startTime;\n        runTime = runTime / (this.timer * 1000);\n        timerWidth = 480 - (480 * runTime);\n        this.ui_ctx.save();\n        this.ui_ctx.clearRect(0, 0, 480, 640);\n        this.animateEmoji(timeDelta);\n        if (this.alerts.length > 0){\n          this.animateAlerts(timeDelta);\n        }\n        this.draw(this.ui_ctx);\n        this.lastTime = time;\n        this.ui_ctx.fillStyle=\"#836d95\";\n        this.ui_ctx.fillRect(0, 620, timerWidth, 640);\n        this.ui_ctx.restore();\n\n        if (runTime < 1) {\n          requestAnimationFrame(animate);\n        } else {\n          console.log('ended');\n          return resolve('Game ended');\n        }\n\n      };\n      startTime = new Date().getTime();\n      animate(this.lastTime);\n\n    });\n\n  }\n\n\n  renderEmoji() {\n    let W = this.ui_canvas.width;\n    let min = 50;\n    let max = W - min;\n    let posX = Math.random() * (max - min) + min;\n\n    let emoji = new FallingEmoji({\n      game: this,\n      ctx: this.ui_ctx,\n      canvas: this.ui_canvas,\n      pos: [posX, 0],\n      vel: [0, this.velocity]\n    });\n\n    this.fallingEmoji[emoji.emojiCode] = emoji;\n  }\n\n  recenterMask(){\n    let canvas = this.detector.dt_canvas;\n    let ctx = this.detector.dt_ctx;\n    let X = canvas.width * 0.5;\n    let Y = canvas.height * 0.5;\n    let startTime, time;\n    let animation = () => {\n      time = new Date().getTime() - this.startTime;\n      time = time / 1000;\n      ctx.fillStyle=\"rgba(0,0,0,.7)\";\n      ctx.fillRect(0, 0, 480, 600);\n      ctx.save();\n      ctx.beginPath();\n      ctx.moveTo(X - 100, Y - 100);\n      ctx.bezierCurveTo(X-100, Y-220, X+100, Y-220, X+100, Y-100);\n      ctx.bezierCurveTo(X+100, Y+130, X-100, Y+130, X-100, Y-100);\n      ctx.lineWidth = 5;\n      ctx.clip();\n      ctx.clearRect(0, 0, 480, 640);\n      ctx.restore();\n      if (time<1) requestAnimationFrame(animation);\n    };\n    startTime = this.recenterStartTime;\n    animation();\n  }\n\n\n  animateEmoji(timeDelta){\n    for (var emojiCode in this.fallingEmoji) {\n      this.fallingEmoji[emojiCode].move(timeDelta);\n    }\n  }\n\n  animateAlerts(timeDelta){\n    this.alerts.forEach((alert) => {\n      alert.animate(timeDelta);\n    });\n  }\n\n  draw(ctx) {\n    for (var emojiCode in this.fallingEmoji) {\n      this.fallingEmoji[emojiCode].draw(ctx);\n    }\n  }\n\n  removeEmoji(eCode){\n    this.lastEmoji = this.fallingEmoji[eCode];\n    delete this.fallingEmoji[eCode];\n  }\n\n  removeAlert(alert){\n    this.alerts.splice(this.alerts.indexOf(alert), 1);\n  }\n\n  checkMatch() {\n    let check = () => {\n      requestAnimationFrame(check);\n      var emoji = this.detector.dominantEmoji;\n      if (emoji in this.fallingEmoji) {\n        this.matched(emoji);\n      }\n    };\n    if (this.playing) {\n      check();\n    }\n  }\n\n  matched(eCode) {\n    let timestamp = this.fallingEmoji[eCode].timestamp;\n    this.removeEmoji(eCode);\n    this.mask_animation = 'match';\n\n    this.scorePoints(timestamp);\n    this.increaseDifficulty();\n    this.detector.mask = new Image();\n    this.detector.mask.src = this.detector.emoji_images[eCode];\n    window.setTimeout(() => {\n      this.mask_animation = 'none';\n    }, 1000);\n  }\n\n  scorePoints(timestamp) {\n    let elapsedTime = Date.now() - timestamp;\n    let score = 10 + (10000 - elapsedTime) * this.multiplier;\n    this.score += score;\n    this.announce({\n      time: elapsedTime,\n      score: score,\n    });\n\n    // this.displayScore.innerHTML = `Score: ${this.score}`;\n    this.displayScore.forEach((score) => {\n      score.innerHTML = `Score: ${this.score}`;\n    });\n  }\n\n  increaseDifficulty() {\n\n    this.velocity += 0.2;\n    this.renderDelay -= 750;\n    this.multiplier += 1;\n    console.log('difficulty increased');\n    console.log(this.renderDelay);\n  }\n\n  getStrike(){\n    this.announce({strike: this.strikes + 1});\n    this.multiplier = 0;\n    this.strikes += 1;\n  }\n\n  announce(options){\n    let W = this.ui_canvas.width;\n    let min = 100;\n    let max = W - min;\n    let posX = Math.random() * (max - (min* 2)) + min;\n\n    let alert = new Announce({\n      game: this,\n      ctx: this.ui_ctx,\n      canvas: this.ui_canvas,\n      pos: [posX, 200],\n      time: options.time,\n      score: options.score,\n      strike: options.strike,\n    });\n\n    this.alerts.push(alert);\n  }\n\n}\n\nexport default Game;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lib/game.js\n// module id = 3\n// module chunks = 0","import {\n  EmojiImages\n} from './emoji';\n\nclass FallingEmoji {\n  constructor(options) {\n    this.ctx = options.ctx;\n    this.canvas = options.canvas;\n    this.pos = options.pos;\n    this.vel = options.vel;\n    this.game = options.game;\n    this.emojiCode = null;\n    this.emoji = null;\n    this.emoji_images = EmojiImages.falling;\n\n    this.timestamp = Date.now();\n    this.generateEmoji(this.ctx);\n  }\n\n  generateEmoji(ctx) {\n    let values = Object.keys(this.emoji_images);\n\n    let available = values.filter((value) => {\n      if (!(Object.keys(this.game.fallingEmoji).includes(value)) && (value !== '128528')) {\n        return value;\n      }\n    });\n    this.emojiCode = available[Math.floor(Math.random() * available.length)];\n    this.emoji = new Image();\n    this.emoji.src = this.emoji_images[this.emojiCode];\n    this.draw(ctx);\n  }\n\n  draw(ctx) {\n    ctx.drawImage(this.emoji, this.pos[0], this.pos[1], 100, 100);\n  }\n\n  move(timeDelta) {\n    const velocityScale = timeDelta / NORMAL_FRAME_TIME_DELTA,\n      offsetX = this.vel[0] * velocityScale,\n      offsetY = this.vel[1] * velocityScale;\n\n    this.pos = [this.pos[0] + offsetX, this.pos[1] + offsetY];\n    if (this.pos[1] > 650) {\n      this.remove();\n      this.game.getStrike();\n    }\n  }\n\n  remove() {\n    this.game.removeEmoji(this.emojiCode);\n  }\n\n}\n\nconst NORMAL_FRAME_TIME_DELTA = 1000 / 60;\n\nexport default FallingEmoji;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lib/falling_emoji.js\n// module id = 4\n// module chunks = 0","\nclass Announce {\n  constructor(options){\n    this.game = options.game;\n    this.ctx = options.ctx;\n    this.canvas = options.canvas;\n    this.time = options.time;\n    this.score = options.score;\n    this.strike = options.strike;\n    this.pos =  options.pos;\n    this.vel = [0, 1];\n    this.alert = null;\n    this.generateAlert(options);\n  }\n\n  generateAlert(options){\n    let a = arguments[0];\n    if (a.strike) {\n      this.alert = this.strikeAnimation;\n    } else if (a.score) {\n      this.alert = this.scoreAnimation;\n    }\n    let move = setTimeout(() => {\n      this.game.removeAlert(this);\n      clearTimeout(move);\n    }, 600);\n  }\n\n  strikeAnimation(){\n    let strike = this.strike;\n    this.ctx.font = \"bold 36px Josefin Sans\";\n    this.ctx.textAlign = \"center\";\n    this.ctx.fillStyle = \"red\";\n    this.ctx.strokeStyle = 'white';\n    this.ctx.lineWidth = 2;\n    this.ctx.fillText(`Strike ${strike} !!`, this.pos[0], this.pos[1]);\n    this.ctx.strokeText(`Strike ${strike} !!`, this.pos[0], this.pos[1]);\n    this.ctx.fill();\n    this.ctx.stroke();\n  }\n\n  scoreAnimation(){\n    let message;\n    // console.log(this.time);\n    if (this.time < 2600) {\n      this.messageAnimation('Perfect!');\n    } else if (this.time >= 2600 && this.time < 2500) {\n      this.messageAnimation('Good');\n    }\n\n    let score = this.score;\n    this.ctx.font = \"36px Josefin Sans\";\n    this.ctx.textAlign = \"center\";\n    this.ctx.fillStyle = \"green\";\n    this.ctx.fillText(`+ ${score} !!`, this.pos[0], this.pos[1]);\n  }\n\n  messageAnimation(message){\n    let strike = this.strike;\n    this.ctx.font = \"36px Josefin Sans\";\n    this.ctx.textAlign = \"center\";\n    this.ctx.fillStyle = \"green\";\n    this.ctx.fillText(`${message}`, this.pos[0], this.pos[1] - 50);\n  }\n\n\n  animate(timeDelta) {\n    const velocityScale = timeDelta / NORMAL_FRAME_TIME_DELTA,\n        offsetY = this.vel[1] * velocityScale;\n    this.pos = [this.pos[0], this.pos[1] - offsetY];\n\n    this.alert();\n\n  }\n\n}\n\nconst NORMAL_FRAME_TIME_DELTA = 1000/60;\n\nexport default Announce;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./lib/announce.js\n// module id = 5\n// module chunks = 0"],"sourceRoot":""}